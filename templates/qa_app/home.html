{% extends 'qa_app/base.html' %}
{% load html_filters %}

{% block title %}Главная - Вопросы и Ответы{% endblock %}

{% block extra_head %}
<style>
/* Стили для главной страницы */
.hero-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    color: white;
    padding: 4rem 2rem;
    margin-bottom: 3rem;
    text-align: center;
}

.hero-section h1 {
    font-size: 2.8rem;
    font-weight: 700;
    margin-bottom: 1rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.hero-section p {
    font-size: 1.2rem;
    opacity: 0.9;
    max-width: 600px;
    margin: 0 auto 2rem;
}

.hero-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
}

.stat-card {
    border: none;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    transition: transform 0.2s;
    height: 100%;
}

.stat-card:hover {
    transform: translateY(-3px);
}

.stat-card .card-body {
    text-align: center;
    padding: 1.5rem;
}

.stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: #212529;
}

.stat-label {
    font-size: 0.9rem;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.feature-card {
    border: 1px solid #e9ecef;
    border-radius: 10px;
    overflow: hidden;
    transition: all 0.3s;
    height: 100%;
}

.feature-card:hover {
    border-color: #0d6efd;
    box-shadow: 0 5px 15px rgba(13, 110, 253, 0.1);
}

.feature-card .card-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid #e9ecef;
    font-weight: 600;
}

.quick-links {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
}

.quick-link-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1.5rem 1rem;
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 10px;
    text-decoration: none;
    color: #495057;
    transition: all 0.2s;
}

.quick-link-item:hover {
    border-color: #0d6efd;
    color: #0d6efd;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.quick-link-item i {
    font-size: 2rem;
    margin-bottom: 1rem;
    color: #6c757d;
}

.quick-link-item:hover i {
    color: #0d6efd;
}

.question-preview {
    border-left: 3px solid transparent;
    padding-left: 1rem;
    transition: all 0.2s;
}

.question-preview:hover {
    border-left-color: #0d6efd;
    background-color: #f8f9fa;
}

.question-preview-title {
    font-weight: 600;
    margin-bottom: 0.25rem;
    color: #212529;
}

.question-preview-meta {
    font-size: 0.85rem;
    color: #6c757d;
}

.empty-state {
    text-align: center;
    padding: 3rem 1rem;
    color: #6c757d;
}

.empty-state i {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

@media (max-width: 768px) {
    .hero-section {
        padding: 2rem 1rem;
    }

    .hero-section h1 {
        font-size: 2rem;
    }

    .hero-buttons {
        flex-direction: column;
    }

    .hero-buttons .btn {
        width: 100%;
    }
}
</style>
{% endblock %}

{% block content %}
<!-- Герой-секция -->
<div class="hero-section">
    <h1>Найдите ответы на свои вопросы</h1>
    <p>Сообщество экспертов готово помочь вам решить любые технические вопросы. Задавайте вопросы, делитесь знаниями и находите решения вместе.</p>

    <div class="hero-buttons">
        <a href="{% url 'qa_app:create_question' %}" class="btn btn-light btn-lg px-4">
            <i class="fas fa-plus-circle me-2"></i>Задать вопрос
        </a>
        <a href="{% url 'qa_app:question_list' %}" class="btn btn-outline-light btn-lg px-4">
            <i class="fas fa-search me-2"></i>Найти ответы
        </a>
    </div>
</div>

<!-- Быстрые ссылки -->
<div class="row mb-5">
    <div class="col-12">
        <h2 class="mb-4">Быстрый доступ</h2>
        <div class="quick-links">
            <a href="{% url 'qa_app:question_list' %}" class="quick-link-item">
                <i class="fas fa-question-circle"></i>
                <span>Все вопросы</span>
            </a>
            <a href="{% url 'qa_app:question_list' %}?answered=yes" class="quick-link-item">
                <i class="fas fa-check-circle"></i>
                <span>С ответами</span>
            </a>
            <a href="{% url 'qa_app:question_list' %}?answered=no" class="quick-link-item">
                <i class="fas fa-clock"></i>
                <span>Без ответов</span>
            </a>
            <a href="{% url 'qa_app:create_question' %}" class="quick-link-item">
                <i class="fas fa-plus-circle"></i>
                <span>Новый вопрос</span>
            </a>
        </div>
    </div>
</div>

<!-- Основной контент -->
<div class="row g-4">
    <!-- Левая колонка: Статистика и последние вопросы -->
    <div class="col-lg-8">
        <!-- Статистика -->
        <div class="row mb-5">
            <div class="col-md-4 mb-3">
                <div class="card stat-card">
                    <div class="card-body">
                        <div class="stat-number">{{ question_count|default:0 }}</div>
                        <div class="stat-label">Всего вопросов</div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card stat-card">
                    <div class="card-body">
                        <div class="stat-number">{{ answered_count|default:0 }}</div>
                        <div class="stat-label">С ответами</div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card stat-card">
                    <div class="card-body">
                        <div class="stat-number">{{ categories|length|default:0 }}</div>
                        <div class="stat-label">Категорий</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Последние вопросы -->
        <div class="card feature-card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="fas fa-clock me-2"></i>Последние вопросы</span>
                <a href="{% url 'qa_app:question_list' %}" class="btn btn-sm btn-outline-primary">
                    Все вопросы <i class="fas fa-arrow-right ms-1"></i>
                </a>
            </div>
            <div class="card-body">
                {% if recent_questions %}
                    <div class="list-group list-group-flush">
                        {% for question in recent_questions %}
                            <a href="{% url 'qa_app:question_detail' pk=question.pk %}"
                               class="list-group-item list-group-item-action border-0 question-preview">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="flex-grow-1">
                                        <div class="question-preview-title">
                                            {{ question.title|truncatechars:60 }}
                                        </div>
                                        <div class="question-preview-meta">
                                            <i class="fas fa-calendar-alt me-1"></i>
                                            {{ question.created_at|date:"d.m.Y" }}
                                            <span class="mx-2">•</span>
                                            <i class="fas fa-eye me-1"></i>
                                            {{ question.views }} просмотров
                                            {% if question.category %}
                                            <span class="mx-2">•</span>
                                            <i class="fas fa-folder me-1"></i>
                                            {{ question.category.name }}
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="ms-3">
                                        {% if question.has_answer %}
                                        <span class="badge bg-success">
                                            <i class="fas fa-check"></i>
                                        </span>
                                        {% else %}
                                        <span class="badge bg-warning">
                                            <i class="fas fa-clock"></i>
                                        </span>
                                        {% endif %}
                                    </div>
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-question-circle"></i>
                        <h4>Вопросов пока нет</h4>
                        <p class="mb-0">Будьте первым, кто задаст вопрос!</p>
                        <a href="{% url 'qa_app:create_question' %}" class="btn btn-primary mt-3">
                            Задать первый вопрос
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Популярные вопросы -->
        <div class="card feature-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="fas fa-fire me-2"></i>Популярные вопросы</span>
                <a href="{% url 'qa_app:question_list' %}?sort=views" class="btn btn-sm btn-outline-primary">
                    Все популярные <i class="fas fa-arrow-right ms-1"></i>
                </a>
            </div>
            <div class="card-body">
                {% if answered_questions %}
                    <div class="list-group list-group-flush">
                        {% for question in answered_questions|slice:":5" %}
                            <a href="{% url 'qa_app:question_detail' pk=question.pk %}"
                               class="list-group-item list-group-item-action border-0 question-preview">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="flex-grow-1">
                                        <div class="question-preview-title">
                                            {{ question.title|truncatechars:60 }}
                                        </div>
                                        <div class="question-preview-meta">
                                            <i class="fas fa-eye me-1"></i>
                                            {{ question.views }} просмотров
                                            <span class="mx-2">•</span>
                                            <i class="fas fa-check-circle me-1 text-success"></i>
                                            Ответ от {{ question.updated_at|date:"d.m.Y" }}
                                        </div>
                                    </div>
                                    <div class="ms-3 text-muted">
                                        <small>{% with clean_text=question.answer|striptags %}{{ clean_text|truncatechars:50 }}{% endwith %}</small>
                                    </div>
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <h4>Нет популярных вопросов</h4>
                        <p class="mb-0">Здесь появятся вопросы с наибольшим количеством просмотров</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Правая колонка: Категории и теги -->
    <div class="col-lg-4">
        <!-- Категории -->
        <div class="card feature-card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="fas fa-folder me-2"></i>Категории</span>
                <a href="{% url 'qa_app:question_list' %}" class="btn btn-sm btn-outline-primary">
                    Все <i class="fas fa-arrow-right ms-1"></i>
                </a>
            </div>
            <div class="card-body">
                {% if categories %}
                    <div class="list-group list-group-flush">
                        {% for category in categories|slice:":10" %}
                            <a href="{% url 'qa_app:category_questions' slug=category.slug %}"
                               class="list-group-item list-group-item-action d-flex justify-content-between align-items-center border-0 py-2">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-folder text-primary me-3"></i>
                                    <div>
                                        <div class="fw-medium">{{ category.name }}</div>
                                        {% if category.description %}
                                        <small class="text-muted">{{ category.description|truncatechars:40 }}</small>
                                        {% endif %}
                                    </div>
                                </div>
                                <span class="badge bg-primary rounded-pill">
                                    {{ category.question_count|default:0 }}
                                </span>
                            </a>
                        {% endfor %}

                        {% if categories|length > 10 %}
                            <div class="text-center mt-3">
                                <a href="{% url 'qa_app:question_list' %}" class="btn btn-sm btn-outline-secondary">
                                    <i class="fas fa-ellipsis-h me-1"></i>
                                    Показать все категории
                                </a>
                            </div>
                        {% endif %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h4>Категорий нет</h4>
                        <p class="mb-0">Категории пока не созданы</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Популярные теги -->
        {% if popular_tags %}
        <div class="card feature-card mb-4">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-tags me-2"></i>Популярные теги</h6>
            </div>
            <div class="card-body">
                <div class="d-flex flex-wrap gap-2">
                    {% for tag in popular_tags|slice:":15" %}
                        <a href="{% url 'qa_app:search_questions' %}?query={{ tag.name|urlencode }}&search_in=tags"
                           class="badge bg-light text-dark text-decoration-none border py-2 px-3 d-flex align-items-center"
                           title="{{ tag.count }} вопросов">
                            <i class="fas fa-tag me-2 text-primary"></i>
                            {{ tag.name }}
                            <span class="badge bg-secondary rounded-pill ms-2">{{ tag.count }}</span>
                        </a>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Как это работает -->
        <div class="card feature-card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Как это работает</h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-12">
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center"
                                     style="width: 40px; height: 40px;">
                                    <i class="fas fa-question"></i>
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="mb-1">1. Задайте вопрос</h6>
                                <p class="text-muted small mb-0">Опишите свою проблему подробно</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <div class="rounded-circle bg-success text-white d-flex align-items-center justify-content-center"
                                     style="width: 40px; height: 40px;">
                                    <i class="fas fa-comments"></i>
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="mb-1">2. Получите ответы</h6>
                                <p class="text-muted small mb-0">Сообщество экспертов поможет вам</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <div class="rounded-circle bg-info text-white d-flex align-items-center justify-content-center"
                                     style="width: 40px; height: 40px;">
                                    <i class="fas fa-check-double"></i>
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="mb-1">3. Найдите решение</h6>
                                <p class="text-muted small mb-0">Выберите лучший ответ для вашей проблемы</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Призыв к действию -->
<div class="card mt-5 border-primary">
    <div class="card-body text-center py-5">
        <h2 class="mb-3">Готовы найти ответы?</h2>
        <p class="text-muted mb-4">Присоединяйтесь к нашему сообществу экспертов и разработчиков</p>
        <div class="d-flex justify-content-center gap-3 flex-wrap">
            <a href="{% url 'qa_app:create_question' %}" class="btn btn-primary btn-lg px-4">
                <i class="fas fa-plus-circle me-2"></i>Задать вопрос
            </a>
            <a href="{% url 'qa_app:question_list' %}" class="btn btn-outline-primary btn-lg px-4">
                <i class="fas fa-search me-2"></i>Искать ответы
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Анимация при скролле
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animate__animated', 'animate__fadeInUp');
            }
        });
    }, observerOptions);

    // Наблюдаем за карточками
    document.querySelectorAll('.stat-card, .feature-card').forEach(card => {
        observer.observe(card);
    });

    // Счетчик статистики (анимация)
    const statNumbers = document.querySelectorAll('.stat-number');
    statNumbers.forEach(number => {
        const target = parseInt(number.textContent);
        let current = 0;
        const increment = target / 50;
        const timer = setInterval(() => {
            current += increment;
            if (current >= target) {
                current = target;
                clearInterval(timer);
            }
            number.textContent = Math.floor(current);
        }, 20);
    });
});
</script>
{% endblock %}