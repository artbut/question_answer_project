<!-- _sidebar_content.html -->
<!-- Поиск категорий -->
<div class="card mb-3">
    <div class="card-body p-3">
        <div class="input-group input-group-sm">
            <span class="input-group-text bg-light border-end-0">
                <i class="fas fa-search text-muted"></i>
            </span>
            <input type="text"
                   id="category-search"
                   class="form-control border-start-0"
                   placeholder="Найти категорию..."
                   aria-label="Поиск категории">
        </div>
    </div>
</div>

<!-- Фильтр по категориям -->
<div class="card mb-4">
    <div class="card-header bg-primary text-white py-2">
        <h6 class="mb-0">
            <i class="fas fa-folder me-2"></i>Категории
            <span class="badge bg-light text-primary float-end">{{ categories|length }}</span>
        </h6>
    </div>
    <div class="card-body p-0">
        <div class="list-group list-group-flush" id="categories-list">
            <a href="{% url 'qa_app:question_list' %}"
               class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-2 px-3 border-0 {% if not current_category %}active{% endif %}">
                <span>
                    <i class="fas fa-layer-group me-2"></i>
                    <strong>Все категории</strong>
                </span>
                <span class="badge bg-primary rounded-pill">{{ question_count }}</span>
            </a>

            {% for category in categories %}
            <a href="{% url 'qa_app:category_questions' slug=category.slug %}"
               class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-2 px-3 border-0 category-item {% if current_category.slug == category.slug %}active{% endif %}"
               data-category="{{ category.name|lower }}">
                <span>
                    <i class="fas fa-folder{% if current_category.slug == category.slug %}-open{% endif %} me-2"></i>
                    {{ category.name }}
                </span>
                <span class="badge bg-secondary rounded-pill">{{ category.question_count|default:0 }}</span>
            </a>
            {% empty %}
            <div class="p-3 text-center text-muted">
                <i class="fas fa-inbox fa-2x mb-2"></i>
                <p class="mb-0">Категории не найдены</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Фильтр по статусу ответа -->
<div class="card mb-4">
    <div class="card-header bg-success text-white py-2">
        <h6 class="mb-0">
            <i class="fas fa-check-circle me-2"></i>Статус ответа
        </h6>
    </div>
    <div class="card-body p-0">
        <div class="list-group list-group-flush">
            {% with answered=request.GET.answered|default:'all' %}
            <a href="?answered=all{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if current_category %}&category={{ current_category.slug }}{% endif %}"
               class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-2 px-3 border-0 {% if answered == 'all' or not answered %}active{% endif %}">
                <span>
                    <i class="fas fa-globe me-2"></i>
                    Все вопросы
                </span>
                <span class="badge bg-primary rounded-pill">{{ question_count }}</span>
            </a>
            <a href="?answered=yes{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if current_category %}&category={{ current_category.slug }}{% endif %}"
               class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-2 px-3 border-0 {% if answered == 'yes' %}active{% endif %}">
                <span>
                    <i class="fas fa-check me-2"></i>
                    С ответами
                </span>
                <span class="badge bg-success rounded-pill">{{ answered_count }}</span>
            </a>
            <a href="?answered=no{% if sort_by %}&sort={{ sort_by }}{% endif %}{% if current_category %}&category={{ current_category.slug }}{% endif %}"
               class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-2 px-3 border-0 {% if answered == 'no' %}active{% endif %}">
                <span>
                    <i class="fas fa-question me-2"></i>
                    Без ответов
                </span>
                <span class="badge bg-warning rounded-pill">{{ unanswered_count }}</span>
            </a>
            {% endwith %}
        </div>
    </div>
</div>

<!-- Сортировка -->
<div class="card mb-4">
    <div class="card-header bg-info text-white py-2">
        <h6 class="mb-0">
            <i class="fas fa-sort-amount-down me-2"></i>Сортировка
        </h6>
    </div>
    <div class="card-body p-0">
        <div class="list-group list-group-flush">
            {% with sort=request.GET.sort|default:'-created_at' %}
            <a href="?sort=-created_at{% if answered_filter %}&answered={{ answered_filter }}{% endif %}{% if current_category %}&category={{ current_category.slug }}{% endif %}"
               class="list-group-item list-group-item-action py-2 px-3 border-0 {% if sort == '-created_at' %}active{% endif %}">
                <i class="fas fa-clock me-2"></i>
                Сначала новые
            </a>
            <a href="?sort=created_at{% if answered_filter %}&answered={{ answered_filter }}{% endif %}{% if current_category %}&category={{ current_category.slug }}{% endif %}"
               class="list-group-item list-group-item-action py-2 px-3 border-0 {% if sort == 'created_at' %}active{% endif %}">
                <i class="fas fa-history me-2"></i>
                Сначала старые
            </a>
            <a href="?sort=views{% if answered_filter %}&answered={{ answered_filter }}{% endif %}{% if current_category %}&category={{ current_category.slug }}{% endif %}"
               class="list-group-item list-group-item-action py-2 px-3 border-0 {% if sort == 'views' %}active{% endif %}">
                <i class="fas fa-fire me-2"></i>
                Популярные
            </a>
            <a href="?sort=title{% if answered_filter %}&answered={{ answered_filter }}{% endif %}{% if current_category %}&category={{ current_category.slug }}{% endif %}"
               class="list-group-item list-group-item-action py-2 px-3 border-0 {% if sort == 'title' %}active{% endif %}">
                <i class="fas fa-sort-alpha-down me-2"></i>
                По названию (А-Я)
            </a>
            <a href="?sort=-title{% if answered_filter %}&answered={{ answered_filter }}{% endif %}{% if current_category %}&category={{ current_category.slug }}{% endif %}"
               class="list-group-item list-group-item-action py-2 px-3 border-0 {% if sort == '-title' %}active{% endif %}">
                <i class="fas fa-sort-alpha-down-alt me-2"></i>
                По названию (Я-А)
            </a>
            {% endwith %}
        </div>
    </div>
</div>

<!-- Статистика -->
<div class="card stats-card">
    <div class="card-header text-white py-2">
        <h6 class="mb-0">
            <i class="fas fa-chart-bar me-2"></i>Статистика
        </h6>
    </div>
    <div class="card-body">
        <div class="row text-center g-3">
            <div class="col-6">
                <div class="stats-number">{{ question_count }}</div>
                <div class="stats-label">Всего вопросов</div>
            </div>
            <div class="col-6">
                <div class="stats-number">{{ answered_count }}</div>
                <div class="stats-label">С ответами</div>
            </div>
        </div>

        {% if question_count > 0 %}
        <div class="mt-3">
            <div class="d-flex justify-content-between mb-1">
                <small class="text-muted">Процент отвеченных:</small>
                <small class="text-muted">
                    {% widthratio answered_count question_count 100 %}%
                </small>
            </div>
            <div class="progress">
                <div class="progress-bar bg-success"
                     role="progressbar"
                     style="width: {% widthratio answered_count question_count 100 %}%"
                     aria-valuenow="{% widthratio answered_count question_count 100 %}"
                     aria-valuemin="0"
                     aria-valuemax="100">
                </div>
            </div>
        </div>
        {% endif %}

        <div class="mt-3 text-center">
            <small class="text-muted">
                <i class="fas fa-info-circle me-1"></i>
                {% if current_category %}
                В категории "{{ current_category.name }}"
                {% else %}
                Во всех категориях
                {% endif %}
            </small>
        </div>
    </div>
</div>

<!-- Популярные теги -->
{% if popular_tags %}
<div class="card mt-4">
    <div class="card-header bg-dark text-white py-2">
        <h6 class="mb-0">
            <i class="fas fa-tags me-2"></i>Популярные теги
        </h6>
    </div>
    <div class="card-body">
        <div class="tag-cloud">
            {% for tag in popular_tags %}
            <a href="{% url 'qa_app:search_questions' %}?query={{ tag.name|urlencode }}&search_in=tags"
               class="tag-badge"
               title="{{ tag.count }} вопросов">
                {{ tag.name }}
                <small class="text-muted">({{ tag.count }})</small>
            </a>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}